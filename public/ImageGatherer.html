<!DOCTYPE html>
<html>

<head>
    <title>Image Gatherer</title>
</head>

<body style="background-color: #2f3033">

    <h1 style="color: #ffffff">Reddit Image Gathering</h1>
    <h4 style="color: #ffffff">Specify a subreddit and how many posts you want to search for images and send the
        request!</h4>


    <p style="color: #ffffff">
        subreddit to search: <span> <input style="background-color: #ffffff" id="subredditToSearch" value="Gonewild">
        </span><br>
        SearchAmount: <span> <input style="background-color: #ffffff" id="SearchAmount" value="15"> </span><br>
    </p>
    <button style="background-color: #ffffff" onclick="SendImageGatheringRequest()"> Send Image gather request</button>

    <br>
    <br>
    <br>
    <br>
    <button id="LogOutButton" style="background-color: #ffffff"> Log out</button>


    <!--===============  scripts  ==================-->
    <script>

        // Reddit Server Requests
        async function SendImageGatheringRequest() {
            const subreddit = document.getElementById('subredditToSearch').value;
            const amount = document.getElementById('SearchAmount').value;

            const sendData = { subreddit, amount };
            console.log("Sending data: " + JSON.stringify(sendData));
            const options = {
                method: 'POST',
                body: JSON.stringify(sendData),
                headers: { 'Content-Type': 'application/json' }
            };
            const response = await fetch('/ImageLoader', options);
            const data = response.json().then(async function (result) {
                console.log(result);
                if (result.ERROR) {
                    console.log("ERROR:" + result.ERROR);
                    return;
                }

                console.log('Sending path to download!');
                await DownloadFile(result);
            });
        }

        async function DownloadFile(filepath) {
            const options = {
                method: 'POST',
                body: JSON.stringify(filepath),
                headers: { 'Content-Type': 'application/json' }
            };
            console.log('Sent download request!');
            const response = await fetch('/download', options);
            console.log(response.body);
        }

    </script>


    <script type="text/javascript">

        document.getElementById('LogOutButton').onclick = async function () {
            const options =
            {
                method: 'GET'
            };
            const response = await fetch('/LogOut', options);
            console.log(response);
            location.href= '/';
        }

    </script>
</body>

</html>